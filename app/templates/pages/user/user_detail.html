{% extends 'layouts/base.html' %}
{% from 'components/table.html' import load_component_styles %}

{% block styles %}
{{ load_component_styles() }}   
<link rel="stylesheet" href="{{ url_for('static', filename='css/user.css') }}">
{% endblock %}

{% block content %}
    <main>
        <div class="user-table-container"></div>
        <div class="order-table-container"></div>
        <div class="goto-stores-container"></div>
        <div class="goto-items-container"></div>
    </main>
    
    <script src="/static/js/components/table.js"></script>
    <script>
        const id = window.location.pathname.split('/')[3];

        async function fetchUser() {
            await fetch(`/api/users/user/${id}`)
                .then(response => response.json())
                .then(user => {
                        const userData = {
                            keys: ['Name', 'Gender', 'Age', 'Birthdate', 'Address'],
                            items: user
                        };

                        const table = new Table('User Info', userData);
                        document.querySelector('.user-table-container').innerHTML = table.render();
                    })
        }

        async function fetchOrder() {
            await fetch(`/api/users/orders/${id}`)
                .then(response => response.json())
                .then(orders => {
                        const orderData = {
                            keys: ['OrderId', 'OrderAt', 'StoreId'],
                            items: orders
                        };

                        const table = new Table('Order Info', orderData, {
                            linkColumn: ['OrderId', 'StoreId'],
                            baseUrl: ['/orderitems/detail', '/stores/detail']
                        });

                        document.querySelector('.order-table-container').innerHTML = table.render();
                    })
        }

        
        async function fetchGoto() {
            await fetch(`/api/users/goto-stores/${id}`)
                .then(response => response.json())
                .then(stores => {
                        const storeData = {
                            keys: ['Store', 'Count'],
                            items: stores
                        };

                        const table = new Table('자주 방문한 매장 Top 5', storeData);
                        document.querySelector('.goto-stores-container').innerHTML = table.render();
                    })

            await fetch(`/api/users/goto-items/${id}`)
                .then(response => response.json())
                .then(items => {
                        const itemData = {
                            keys: ['Item', 'Count'],
                            items: items
                        };

                        const table = new Table('자주 주문한 메뉴 Top 5', itemData);
                        document.querySelector('.goto-items-container').innerHTML = table.render();
                    })
        }    

        fetchUser();
        fetchOrder();
        fetchGoto();

    </script>
{% endblock %}